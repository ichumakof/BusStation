<Window x:Class="CashierApp.CashierMainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:sys="clr-namespace:System;assembly=mscorlib"
        Title="Рабочее место кассира" Height="600" Width="900" WindowStartupLocation="CenterScreen"
        FontSize="16">
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
    </Window.Resources>

    <Grid Margin="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Header -->
            <RowDefinition Height="Auto"/>
            <!-- Top info (cashier/date) -->
            <RowDefinition Height="Auto"/>
            <!-- Search -->
            <RowDefinition Height="*"/>
            <!-- Trips -->
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="#2196F3" Padding="14" CornerRadius="4" Margin="0,0,0,12">
            <TextBlock Text="ПРОДАЖА БИЛЕТА"
                       Foreground="White"
                       FontWeight="Bold"
                       HorizontalAlignment="Center"
                       VerticalAlignment="Center" FontSize="22"/>
        </Border>

        <!-- Верхняя панель: приветствие и дата -->
        <StackPanel Orientation="Horizontal" Grid.Row="1" VerticalAlignment="Center" Margin="0,0,0,10">
            <TextBlock Text="Кассир: " FontWeight="Bold" VerticalAlignment="Center"/>
            <TextBlock x:Name="tbCashierName" Margin="6,0,20,0" VerticalAlignment="Center" Text="{Binding CashierName}" />
            <TextBlock Text="Дата:" VerticalAlignment="Center" Margin="8,0,6,0"/>
            <DatePicker x:Name="dpDate" SelectedDate="{Binding SelectedDate, Mode=TwoWay}" />
        </StackPanel>

        <!-- Поиск города/остановки -->
        <StackPanel Grid.Row="2" Orientation="Vertical" Margin="0,0,0,10">
            <TextBlock Text="Город / Остановка назначения" Margin="0,0,0,6" FontWeight="Bold"/>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <TextBox x:Name="tbCitySearch" Grid.Row="0" Height="34" Padding="6"
                         VerticalContentAlignment="Center"
                         Text="{Binding SearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                    <TextBox.InputBindings>
                        <KeyBinding Key="Down" Command="{Binding KeyDownDownCommand}" />
                        <KeyBinding Key="Enter" Command="{Binding KeyDownEnterCommand}" />
                    </TextBox.InputBindings>
                </TextBox>

                <!-- Список подсказок -->
                <Border Grid.Row="1" BorderBrush="#CCC" BorderThickness="1" Background="White" 
                        Visibility="{Binding AreSuggestionsVisible, Converter={StaticResource BooleanToVisibilityConverter}}"
                        x:Name="borderSuggestions" MaxHeight="180" Margin="0,4,0,0">
                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <ListBox x:Name="lbSuggestions"
                                 ItemsSource="{Binding Suggestions}"
                                 DisplayMemberPath="CityName"
                                 SelectedItem="{Binding SelectedSuggestion, Mode=TwoWay}"
                                 KeyboardNavigation.TabNavigation="None"/>
                    </ScrollViewer>
                </Border>
            </Grid>
        </StackPanel>

        <!-- Список рейсов -->
        <ScrollViewer Grid.Row="3" VerticalScrollBarVisibility="Auto">
            <ItemsControl x:Name="icTrips" ItemsSource="{Binding Trips}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border BorderBrush="#DDD" BorderThickness="0,0,0,1" Padding="10">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="220"/>
                                    <ColumnDefinition Width="140"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Orientation="Vertical">
                                    <TextBlock FontWeight="Bold" Text="{Binding RouteTitle}"/>
                                    <TextBlock Foreground="#666" Text="{Binding ExtraInfo}" />
                                </StackPanel>

                                <!-- Цена + свободные места -->
                                <StackPanel Grid.Column="1" HorizontalAlignment="Right" VerticalAlignment="Center">
                                    <TextBlock FontWeight="SemiBold" Text="{Binding PriceText}" HorizontalAlignment="Right"/>
                                    <TextBlock Margin="0,6,0,0" HorizontalAlignment="Right">
                                        <Run Text="Свободных мест: "/>
                                        <Run Text="{Binding AvailableSeatsText, Mode=OneWay}" />
                                    </TextBlock>
                                </StackPanel>

                                <!-- Кнопка оформления -->
                                <Button Grid.Column="2"
                                        Width="120"
                                        Height="36"
                                        HorizontalAlignment="Right"
                                        VerticalAlignment="Center"
                                        Content="Оформить"
                                        Command="{Binding DataContext.OpenSellDialogCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                        CommandParameter="{Binding}" />
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>
    </Grid>
</Window>